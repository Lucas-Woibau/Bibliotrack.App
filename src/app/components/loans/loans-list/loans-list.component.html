<div class="container py-4">
  <app-book-loan-nav></app-book-loan-nav>

  <div
    class="d-flex flex-column flex-md-row flex-md-nowrap justify-content-between align-items-md-center gap-3 mb-4"
  >
    <input
      type="text"
      #searchInput
      class="form-control form-control-lg shadow-sm"
      placeholder="Pesquisar por título do livro ou nome da pessoa.."
      (input)="onSearch(searchInput.value)"
    />

    <a
      class="btn btn-primary btn-lg shadow-sm d-flex align-items-center gap-2"
      (click)="openAddLoanModal()"
    >
      <i class="fa-solid fa-book-open-reader"></i>
      <span>Cadastrar Empréstimo</span>
    </a>
  </div>

  <div class="table-responsive shadow-lg rounded-4 border overflow-hidden">
    <table class="table table-hover table-nowrap align-middle mb-0 w-100">
      <thead
        class="bg-body-tertiary text-secondary text-uppercase small position-sticky top-0 z-1"
      >
        <tr>
          <th class="px-4">Livro</th>
          <th class="d-none d-lg-table-cell">Pessoa</th>
          <th class="d-none d-lg-table-cell">Data de Empréstimo</th>
          <th class="d-none d-lg-table-cell">Status</th>
          <th class="text-center" style="width: 120px">Ações</th>
        </tr>
      </thead>

      <tbody class="bg-white">
        @for (loan of Loans; track loan.id) {
          <tr
            class="loan-row"
            [ngClass]="{
              'row-loaned': loan.status === 'Emprestado',
              'row-returned': loan.status === 'Devolvido',
            }"
          >
            <td class="px-4 fw-semibold text-dark loan-title">
              {{ loan.bookTitle }}
            </td>

            <td class="d-none d-lg-table-cell">{{ loan.personName }}</td>

            <td class="text-dark d-none d-lg-table-cell">
              {{ loan.loanDateShort }}
            </td>

            <td class="d-none d-lg-table-cell">
              <span
                class="badge rounded-pill px-3 py-2"
                [ngClass]="{
                  'bg-primary-subtle text-primary':
                    loan.status === 'Emprestado',
                  'bg-success-subtle text-success': loan.status === 'Devolvido',
                }"
              >
                {{ loan.status }}
              </span>
            </td>

            <td class="text-center">
              <div class="d-flex justify-content-center gap-3 action-group">
                <button
                  class="btn-action text-success"
                  [disabled]="loan.status === 'Devolvido'"
                  (click)="openMarkAsReturnedModal(loan.id)"
                  title="Marcar como Devolvido"
                >
                  <i
                    class="fa-solid fa-circle-check fa-lg {{
                      loan.status === 'Devolvido' ? 'text-secondary' : ''
                    }}"
                  ></i>
                </button>

                <button
                  class="btn-action text-primary"
                  (click)="openLoanDetailsModal(loan.id)"
                  title="Detalhes"
                >
                  <i class="fa-solid fa-circle-info fa-lg"></i>
                </button>

                <button
                  class="btn-action text-warning"
                  title="Editar"
                  (click)="openEditLoanModal(loan.id)"
                >
                  <i class="fa-solid fa-pen-to-square fa-lg"></i>
                </button>

                <button
                  class="btn-action text-danger"
                  [disabled]="loan.status === 'Devolvido'"
                  title="Excluir"
                  (click)="openDeleteLoanModal(loan.id)"
                >
                  <i
                    class="fa-solid fa-trash fa-lg {{
                      loan.status === 'Devolvido' ? 'text-secondary' : ''
                    }}"
                  ></i>
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>
    @if (searchInput.value && Loans.length === 0) {
      <div class="text-center py-4 text-muted">
        <i class="fa-solid fa-book-open-reader fa-2x mb-2"></i>
        <p class="mb-0 fw-semibold">Nenhum empréstimo encontrado.</p>
      </div>
    }
  </div>
  <nav class="d-flex justify-content-end align-items-center mt-3">
    <ul class="pagination">
      <li class="page-item disabled">
        <button class="page-link" (click)="prevPage()" [disabled]="page === 1">
          Voltar
        </button>
      </li>
      <li class="page-item" *ngFor="let p of pages" [class.active]="page === p">
        <button class="page-link" (click)="page = p; loadLoans(currentSearch)">
          {{ p }}
        </button>
      </li>

      <li class="page-item">
        <button class="page-link" (click)="nextPage()">Avançar</button>
      </li>
    </ul>
  </nav>
</div>
