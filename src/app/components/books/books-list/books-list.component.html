<div class="container py-4">
  <app-book-loan-nav></app-book-loan-nav>

  <div
    class="d-flex flex-column flex-md-row flex-md-nowrap justify-content-between align-items-md-center gap-3 mb-4"
  >
    <input
      type="text"
      id="searchBox"
      #searchInput
      class="form-control form-control-lg shadow-sm"
      placeholder="Pesquisar por título ou autor..."
      (input)="onSearch(searchInput.value)"
    />

    <a
      class="btn btn-success btn-lg shadow-sm d-flex align-items-center gap-2"
      (click)="openAddBookModal()"
    >
      <i class="fa-solid fa-book"></i>
      <span>Cadastrar Livro</span>
    </a>
  </div>

  <div class="shadow-lg rounded-4 border">
    <div
      class="table-responsive px-3"
      style="overflow-x: auto; overflow-y: hidden"
    >
      <table class="table table-hover table-fixed align-middle mb-0 w-100">
        <thead
          class="bg-body-tertiary text-secondary text-uppercase small position-sticky top-0 z-1"
        >
          <tr>
            <th class="px-3">Título</th>
            <th class="d-none d-lg-table-cell">Autor</th>
            <th class="d-none d-lg-table-cell" style="width: 22%">Descrição</th>
            <th class="text-center d-none d-lg-table-cell">Qtd</th>
            <th class="d-none d-lg-table-cell">Registro</th>
            <th class="d-none d-lg-table-cell">Catálogo</th>
            <th class="d-none d-lg-table-cell">Status</th>
            <th class="text-center" style="width: 120px">Ações</th>
          </tr>
        </thead>

        <tbody class="bg-white">
          @for (book of Books; track book.id) {
            <tr
              class="book-row"
              [ngClass]="{
                'row-available': book.status === 'Disponível',
                'row-unavailable': book.status === 'Indisponível',
              }"
            >
              <td class="truncate col-title" title="{{ book.title }}">
                {{ book.title }}
              </td>

              <td
                class="d-none d-lg-table-cell truncate col-author"
                title="{{ book.author }}"
              >
                {{ book.author }}
              </td>

              <td
                class="d-none d-lg-table-cell truncate col-desc"
                title="{{ book.description }}"
              >
                {{ book.description }}
              </td>

              <td class="d-none d-lg-table-cell col-qtd text-center truncate">
                {{ book.quantity }}
              </td>

              <td class="d-none d-lg-table-cell col-date truncate">
                {{ book.registrationDateShort }}
              </td>

              <td
                class="d-none d-lg-table-cell truncate col-cat truncate"
                title="{{ book.catalog }}"
              >
                {{ book.catalog }}
              </td>

              <td class="d-none d-lg-table-cell col-status truncate">
                <span
                  class="badge rounded-pill px-3 py-2"
                  [ngClass]="{
                    'bg-success-subtle text-success':
                      book.status === 'Disponível',
                    'bg-danger-subtle text-danger':
                      book.status === 'Indisponível',
                  }"
                >
                  {{ book.status }}
                </span>
              </td>

              <td class="col-actions text-center">
                <div class="d-flex justify-content-center gap-3 action-group">
                  <button
                    class="btn-action text-primary"
                    title="Detalhes"
                    (click)="openBookDetailsModal(book.id)"
                  >
                    <i class="fa-solid fa-circle-info fa-lg"></i>
                  </button>

                  <button
                    class="btn-action text-warning"
                    title="Editar"
                    (click)="openEditBookModal(book.id)"
                  >
                    <i class="fa-solid fa-pen-to-square fa-lg"></i>
                  </button>

                  <button
                    class="btn-action text-danger"
                    title="Excluir"
                    (click)="openDeleteBookModal(book.id)"
                  >
                    <i class="fa-solid fa-trash fa-lg"></i>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
      @if (searchInput.value && Books.length === 0) {
        <div class="text-center py-4 text-muted">
          <i class="fa-solid fa-book fa-2x mb-2"></i>
          <p class="mb-0 fw-semibold">Nenhum livro encontrado.</p>
        </div>
      }
    </div>
  </div>
  <nav
    class="d-flex justify-content-end justify-content-md-end justify-content-center align-items-center mt-3"
  >
    <ul class="pagination flex-wrap gap-1 mb-0">
      <li class="page-item" [class.disabled]="page === 1">
        <button class="page-link" (click)="prevPage()" [disabled]="page === 1">
          Voltar
        </button>
      </li>
      <li
        class="page-item"
        *ngFor="let p of visiblePages()"
        [class.active]="page === p"
      >
        <button class="page-link" (click)="page = p; loadBooks(currentSearch)">
          {{ p }}
        </button>
      </li>

      <li class="page-item" [class.disabled]="page === totalPages">
        <button class="page-link" (click)="nextPage()">Avançar</button>
      </li>
    </ul>
  </nav>
</div>
